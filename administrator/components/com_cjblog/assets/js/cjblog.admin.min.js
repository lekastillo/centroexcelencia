var CjBlogAdminFactory = {};

(function($){
	CjBlogAdminFactory.init = function(){
		$('.tooltip-hover').tooltip();
		$(".collapse").collapse();
	};
	
	CjBlogAdminFactory.init_points_form = function(){
		$('form[name="adminForm"]').submit(function(){
			$('#target_names').find('option').attr('selected', true);
		});
		var input = $('#username');
		input.keyup(function(e){
			if(input.val().length > 1 && 
					(e.which == 32 || 
					(e.which >= 48 && e.which <= 57) || 
					(e.which >= 97 && e.which <= 122) || 
					(e.which >= 65 && e.which <= 90))){
				$.ajax({
					url: $('#url-get-usernames').text(),
					data: {'search': input.val()},
					dataType: 'json',
					success: function(data, statusText, xhr, form){
						if(data.data != null){
							$('#source_names').find('option').remove();
							$.each(data.data, function(index, user){
								console.log(user);
								$('#source_names').append($('<option>', {value: user.id}).html(user.username+' ('+user.name+')'));
							});
						}
					}
				});
			}
		});
		$('.to_right').click(function(){$('#source_names option:selected').appendTo($('#target_names'));});
		$('.to_left').click(function(){$('#target_names option:selected').appendTo($('#source_names'));});
		$('.all_right').click(function(){$('#source_names option').appendTo($('#target_names'));});
		$('.all_left').click(function(){$('#target_names option').appendTo($('#source_names'));});
	};
})(jQuery);

jQuery(document).ready(function($){
	CjBlogAdminFactory.init();
	var pageid = $('#cjblog_page_id').val();
	if(pageid == 'points_form') CjBlogAdminFactory.init_points_form();
});